<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.thisteam.muhansangsa.mapper.OutMapper">


<!-- ====================================HAWON=================================== -->
	<!-- 사원검색 -->
	<select id="selectEmp" resultType="Emp_viewVO">
	  
		 SELECT EMP_NUM, EMP_NAME, DEPT_NAME, GRADE_NAME 
		 FROM emp_view
		 WHERE EMP_NAME LIKE '%${keyword}%' 
			 OR DEPT_NAME LIKE '%${keyword}%' 
			 OR GRADE_NAME LIKE '%${keyword}%' 
			 OR EMP_NUM LIKE '%${keyword}%' 
		
	</select>
	
	<!-- 재고있는 상품 검색 -->
	<select id="selectProductStockExist" resultType="Stock_viewVO">
		SELECT PRODUCT_CD,PRODUCT_NAME
		FROM STOCK_VIEW 
		WHERE STOCK_QTY !=0;
		
	</select>
  
  
  
	<!-- ========================================================================= -->





<!-- ==================================== sewon =================================== -->
	<!--출고 예정 목록 조회 페이지 조회용(JSON)  -->
	<!--전체 조회-->
	<select id="selectOutList" resultType="com.thisteam.muhansangsa.vo.Out_scheduleListVO">
		SELECT
			a.out_schedule_cd,
			a.business_no,
			d.cust_name,
			a.emp_num,
			e.emp_name,
			a.out_date,
			a.remarks,
			(
				SELECT concat(MAX(C.PRODUCT_NAME),' 외 ',count(*),'건')  FROM out_schedule_per_product b ,	product c
				WHERE b.product_cd = c.product_cd
				AND b.out_schedule_cd = a.out_schedule_cd
			) product_name,
			a.out_complete,
			(
				SELECT sum(b.out_schedule_qty) FROM out_schedule_per_product b 
				WHERE b.out_schedule_cd = a.out_schedule_cd
			) out_schedule_qty,
			(
				SELECT sum(b.out_qty) FROM out_schedule_per_product b
				WHERE b.out_schedule_cd = a.out_schedule_cd
			) out_qty,
			a.remarks
		FROM
			out_schedule a,
			client d,
			employees e 
		WHERE
			a.business_no = d.business_no
			AND a.EMP_NUM = e.EMP_NUM 
			<if test="status gte 0">
				AND a.out_complete = #{status}
			</if>
			<if test="!keyword.equals('')">
			<choose>
				<when test="searchType.equals('out_schedule_cd')">
					AND a.out_schedule_cd LIKE '%${keyword}%'
				</when>
			</choose>
			</if>
		ORDER BY 
			a.out_schedule_cd DESC
	</select>
  
  
  	<!-- 출고 예정 목록 중 '종결,취소' 로 상태를 변환하기 위한 JSON 작업  -->
  	<update id="outWaitingChangeStatusJson">
	  	UPDATE out_schedule
		  	SET
			<choose>
				<when test='out_complete eq "0"'>
					out_complete='1'
				</when>
				<when test='out_complete eq "1"'>
					out_complete='0'
				</when>
			</choose>
		  	WHERE 
		  		out_schedule_cd = #{out_schedule_cd};
  	</update>
  
	<!-- ========================================================================= -->
  
  
  
</mapper>
