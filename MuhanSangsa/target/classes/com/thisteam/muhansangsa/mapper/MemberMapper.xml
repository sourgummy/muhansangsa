<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.thisteam.muhansangsa.mapper.MemberMapper">
	
	<insert id="insertEmployee" >
			<selectKey keyProperty="idx" resultType="integer" order="BEFORE">
				SELECT MAX(idx) FROM employees
			</selectKey>
			INSERT 
				INTO employees
					VALUES (
						<choose>
							<when test="idx eq '0'">
							1
							</when>
							<otherwise>
							(#{idx} + 1)
							</otherwise>
						</choose>
						<choose>
							<when test="emp_Num eq null">
							,1
							</when>
							<otherwise>
							, #{emp_Num}
							</otherwise>
						</choose>
						,#{emp_Name}
						,#{dept_Cd}
						,#{grade_Cd}
						,#{emp_Tel}
						,#{emp_Dtel}
						,#{emp_Email}
						,#{emp_Passwd}
						,#{emp_Post_No}
						,#{emp_Addr}
						,#{hire_Date}
						,#{work_Cd}
						,#{priv_Cd}
						,#{photo}
					
					); 
		
		</insert>

		<!-- 사원 번호를 위한 부서코드 추출  --> 
		<select id="selectDepartmentCode" resultType="string">
			SELECT DEPT_CD
				FROM department
					WHERE DEPT_NAME = #{dept_Cd}
		</select>

		<!-- 사원 번호를 위한 idx 추출 -->
		<select id="selectIdx" resultType="string">
			SELECT LPAD((MAX(idx) + 1) , 3, '0')
				FROM employees
		</select>
		
		<!-- 권한 업데이트 23/01/30 진행중 -->
		
		<!-- 
		update employees set priv_cd = (select (lpad(priv_cd, 5, '0')) as newCd from employees e as emp where EMP_NUM = '0222' ) where EMP_NUM = '0222';
		update employees set priv_cd = '10011' where EMP_NUM = '0420';
		select (lpad(priv_cd, 5, '0')) as newCd from employees as emp where EMP_NUM = '0222';
		 -->
		<update id="updatePrivCo">
		 	<selectKey keyProperty="priv_cd" resultType="String" order="BEFORE">
		 		SELECT LPAD(priv_cd, 5, '0')
		 			FROM employees
		 			WHERE EMP_NUM = ${emp_num} 
		 	</selectKey>
			
		
		</update>
		
</mapper>
